<!DOCTYPE HTML>
<html>

<head>
  <title>Tasklist</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- All the web compoent neat stuff -->
  <script src="./external/jquery.min.js"></script>
  <script src="./external/handlebars.js"></script>
  <script src="./external/web-component.js"></script>

  <!-- All the boostrap theming -->
  <link rel="stylesheet" href="./external/bootstrap.min.css">
  <script src="./external/bootstrap.min.js"></script>

  <!-- Markdown support -->
  <script src="./external/marked.min.js"></script>

  <!-- Code highlighting support -->
  <link rel="stylesheet" href="./external/github.min.css">
  <script src="./external/highlight.min.js"></script>

  <!-- Date and time formatting -->
  <script src="./js/interpret-date.js"></script>
  <script src="./js/time-until.js"></script>

  <!--[if lt IE 9]>
    <script src="./external/html5shiv.min.js"></script>
    <script src="./external/respond.min.js"></script>
  <![endif]-->
</head>

<body role="document">

  {{NAVIGATION}}

  <div class="jumbotron"></div>

  <div class="container theme-showcase" role="main">
    <h1>Tasks</h1>
    <p>Current timestamp: {{NOW}}</p>

    <tasklist data-source-url="./tasks/json"></tasklist>
  </div>

  <div class="templates">
    <template for="tasklist-item">
      <p>
        <b>{{days-until}}</b> : {{content}}, <i style="opacity: 0.3;">{{date-string}}</i>
        <span class="date">Interpretted: {{interpeted-date}}</span>
        <span class="date">Reference: {{reference-date}}</span>
      </p>
    </template>

    <style for="tasklist-item">
      tasklist-item {
        display: block;
        padding: 5px 0;
      }

      tasklist-item>p>span.date {
        display: none;
      }

      tasklist-item:hover>p>span.date {
        display: block;
      }

      tasklist-item>p {
        padding: 4px;
        border-radius: 5px;
        background: #999;
        margin: 0;
      }

      tasklist-item.past {
        opacity: 0.4;
      }

      tasklist-item.unit-second.past, tasklist-item.unit-minute.past, tasklist-item.unit-hour.past {
        opacity: 1.0;
      }

      tasklist-item.unit-day p {
        background: #AAF;
      }

      tasklist-item.unit-week p {
        background: #FE9;
      }

      tasklist-item.unit-month p {
        background: #AE8;
      }

      tasklist-item.unit-year p {
        background: #CFC;
      }

      tasklist-item.past p {
        background: #999;
      }

      tasklist-item.unit-minute p, tasklist-item.unit-second p {
        background: #F96;
      }

      tasklist-item.unit-hour p {
        background: #FA6;
      }
    </style>

    <template for="tasklist">
      {{#each tasks}}
      <tasklist-item class="{{class}}" date-string="{{dateString}}" entry-date="{{entryDate}}" days-until="{{daysUntil.string}}" reference-date="{{referenceDate.string}}" interpeted-date="{{interpetedDate.string}}">{{text}}</tasklist-item>
      {{/each}}
    </template>

    <script for="tasklist" type="text/javascript">
      $(function() {
        Tasklist = Component.configure('tasklist');

        Tasklist.on('preRenderStep', function(instance) {
          if (!instance.tasks) {
            return;
          }
          instance.tasks.forEach(function(task) {
            task.referenceDate = new Date(task.entryDate * 1000);
            task.interpetedDate = interpretDate(task.referenceDate, task.dateString);
            task.daysUntil = timeUntil(task.interpetedDate);
            task.unit = task.daysUntil.unit;
            task.past = task.daysUntil.past ? 'past' : 'future';
            task.class = ('unit-' + task.unit + ' ' + task.past).trim();
            task.interpetedDate.string = task.interpetedDate.toUTCString();
            task.referenceDate.string = task.referenceDate.toUTCString();
          });

          instance.tasks = instance.tasks.sort(function(a, b) {
            return a.interpetedDate.getTime() - b.interpetedDate.getTime();
          });

        });

        Tasklist.apply(function(instance) {
          instance.render();
        });
      });
    </script>
  </div>
</body>

</html>
